{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","lib/sw-toolbox.js","lib/helpers.js","lib/options.js","lib/router.js","lib/strategies/index.js","lib/simple-db.js","lib/route.js","node_modules/serviceworker-cache-polyfill/index.js","lib/strategies/networkOnly.js","lib/strategies/cacheOnly.js","lib/strategies/networkFirst.js","lib/strategies/cacheFirst.js","lib/strategies/fastest.js","node_modules/path-to-regexp/index.js","node_modules/path-to-regexp/node_modules/isarray/index.js"],"names":["cache","url","options","helpers","openCache","then","add","uncache","precache","items","Array","isArray","preCacheItems","concat","require","router","strategies","debug","flatten","reduce","a","b","self","addEventListener","event","inactiveCache","cacheName","waitUntil","Promise","all","join","addAll","renameCache","handler","match","request","respondWith","module","exports","networkOnly","networkFirst","cacheOnly","cacheFirst","fastest","message","flag","globalOptions","console","log","caches","open","fetchAndCache","successResponses","fetch","clone","response","method","test","status","put","maxCacheEntries","queueCacheExpiration","idbPromise","staticIdb","resolve","simpleDB","idb","cacheExpiration","cacheExpirationPromiseFactory","bind","cacheExpirationPromiseChain","get","lruOrder","oldIndex","indexOf","splice","unshift","length","urlToRemove","pop","set","source","destination","results","sourceCache","destCache","keys","requests","map","scope","registration","URL","location","href","networkTimeoutSeconds","regexEscape","s","replace","Route","keyMatch","string","entriesIterator","entries","item","next","done","pattern","RegExp","value","Router","this","routes","Map","forEach","prototype","path","origin","toLowerCase","route","has","methodMap","routeMap","regexp","matchMethod","pathname","methods","makeHandler","SimpleDBFactory","secret","SECRET","TypeError","SimpleDB","name","db","_name","_db","Object","create","DB_PREFIX","STORE","reject","indexedDB","onupgradeneeded","result","createObjectStore","onsuccess","onerror","error","delete","deleteDatabase","undefined","cmp",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":1960,"endcol":10,"endline":70,"pos":1956,"col":6,"line":70,"value":"name","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":1960,"endcol":10,"endline":70,"pos":1956,"col":6,"line":70,"value":"name","type":"name"},"name":"name"},"key","that","tx","transaction","store","objectStore","req","oncomplete","onabort","clear","callback","openCursor","range","direction","cursor","terminate","ex","abort","getMany","push","setMany","entry","deleteMany","basePath","pathRegexp","exec","values","index","Cache","NetworkError","code","Error","arguments","Request","String","scheme","protocol","responses","i","timeoutId","promises","cacheWhenTimedOutPromise","setTimeout","networkPromise","clearTimeout","statusText","race","rejected","reasons","maybeReject","reason","toString","maybeResolve","Response","parse","str","res","tokens","PATH_REGEXP","m","escaped","offset","slice","prefix","capture","group","suffix","asterisk","repeat","optional","delimiter","escapeGroup","substr","compile","tokensToFunction","matches","obj","data","token","segment","isarray","j","encodeURIComponent","escapeString","attachKeys","re","flags","sensitive","regexpToRegexp","groups","arrayToRegexp","parts","pathToRegexp","stringToRegexp","tokensToRegExp","strict","end","lastToken","endsWithSlash","arr","call"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*\n  Copyright 2014 Google Inc. All Rights Reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n'use strict';\n\nrequire('serviceworker-cache-polyfill');\nvar options = require('./options');\nvar router = require('./router');\nvar helpers = require('./helpers');\nvar strategies = require('./strategies');\n\nhelpers.debug('Service Worker Toolbox is loading');\n\n// Install\n\nvar flatten = function(items) {\n  return items.reduce(function(a, b) {\n    return a.concat(b);\n  }, []);\n};\n\nself.addEventListener('install', function(event) {\n  var inactiveCache = options.cacheName + '$$$inactive$$$';\n  helpers.debug('install event fired');\n  helpers.debug('creating cache [' + inactiveCache + ']');\n  event.waitUntil(\n    helpers.openCache({cacheName: inactiveCache}).then(function(cache) {\n      return Promise.all(options.preCacheItems)\n        .then(flatten)\n        .then(function(preCacheItems) {\n          helpers.debug('preCache list: ' + (preCacheItems.join(', ') || '(none)'));\n          return cache.addAll(preCacheItems);\n        });\n    })\n  );\n});\n\n// Activate\n\nself.addEventListener('activate', function(event) {\n  helpers.debug('activate event fired');\n  var inactiveCache = options.cacheName + '$$$inactive$$$';\n  event.waitUntil(helpers.renameCache(inactiveCache, options.cacheName));\n});\n\n// Fetch\n\nself.addEventListener('fetch', function(event) {\n  var handler = router.match(event.request);\n\n  if (handler) {\n    event.respondWith(handler(event.request));\n  } else if (router.default) {\n    event.respondWith(router.default(event.request));\n  }\n});\n\n// Caching\n\nfunction cache(url, options) {\n  return helpers.openCache(options).then(function(cache) {\n    return cache.add(url);\n  });\n}\n\nfunction uncache(url, options) {\n  return helpers.openCache(options).then(function(cache) {\n    return cache.delete(url);\n  });\n}\n\nfunction precache(items) {\n  if (!Array.isArray(items)) {\n    items = [items];\n  }\n  options.preCacheItems = options.preCacheItems.concat(items);\n}\n\nmodule.exports = {\n  networkOnly: strategies.networkOnly,\n  networkFirst: strategies.networkFirst,\n  cacheOnly: strategies.cacheOnly,\n  cacheFirst: strategies.cacheFirst,\n  fastest: strategies.fastest,\n  router: router,\n  options: options,\n  cache: cache,\n  uncache: uncache,\n  precache: precache\n};\n","/*\n  Copyright 2014 Google Inc. All Rights Reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n'use strict';\n\nvar globalOptions = require('./options');\nvar simpleDB = require('./simple-db');\n\nfunction debug(message, options) {\n  options = options || {};\n  var flag = options.debug || globalOptions.debug;\n  if (flag) {\n    console.log('[sw-toolbox] ' + message);\n  }\n}\n\nfunction openCache(options) {\n  options = options || {};\n  var cacheName = options.cacheName || globalOptions.cacheName;\n  debug('Opening cache \"' + cacheName + '\"', options);\n  return caches.open(cacheName);\n}\n\nfunction fetchAndCache(request, options) {\n  options = options || {};\n  var successResponses = options.successResponses || globalOptions.successResponses;\n\n  return fetch(request.clone()).then(function(response) {\n    // Only cache GET requests with successful responses.\n    // Since this is not part of the promise chain, it will be done asynchronously and will not\n    // block the response from being returned to the page.\n    if (request.method === 'GET' && successResponses.test(response.status)) {\n      openCache(options).then(function(cache) {\n        cache.put(request, response).then(function() {\n          // This will be false-y if maxCacheEntries is set to 0, but that should be fine.\n          // Using a maximum cache size of 0 is incompatible with caching.\n          if (options.maxCacheEntries || globalOptions.maxCacheEntries) {\n            queueCacheExpiration(request, cache, options);\n          }\n        });\n      });\n    }\n\n    return response.clone();\n  });\n}\n\nvar staticIdb;\nfunction idbPromise() {\n  if (staticIdb) {\n    return Promise.resolve(staticIdb);\n  }\n\n  return simpleDB.open('sw-toolbox-lru-order').then(function(idb) {\n    staticIdb = idb;\n    return staticIdb;\n  });\n}\n\nvar cacheExpirationPromiseChain;\nfunction queueCacheExpiration(request, cache, options) {\n  var cacheExpiration = cacheExpirationPromiseFactory.bind(null, request, cache, options);\n\n  if (cacheExpirationPromiseChain) {\n    cacheExpirationPromiseChain = cacheExpirationPromiseChain.then(cacheExpiration);\n  } else {\n    cacheExpirationPromiseChain = cacheExpiration();\n  }\n}\n\nfunction cacheExpirationPromiseFactory(request, cache, options) {\n  var cacheName = options.cacheName || globalOptions.cacheName;\n  var maxCacheEntries = options.maxCacheEntries || globalOptions.maxCacheEntries;\n\n  debug('Updating LRU order for ' + request.url + '. Max entries is ' + maxCacheEntries);\n  return idbPromise().then(function(idb) {\n    return idb.get(cacheName).then(function(lruOrder) {\n      if (!Array.isArray(lruOrder)) {\n        lruOrder = [];\n      }\n\n      var url = request.url;\n      var oldIndex = lruOrder.indexOf(url);\n      if (oldIndex > 0) {\n        // If url already is in the array, and it's not in the first position, remove it.\n        lruOrder.splice(oldIndex, 1);\n      }\n      if (oldIndex !== 0) {\n        // If url isn't already in the first position, add it there.\n        lruOrder.unshift(url);\n      }\n\n      if (lruOrder.length > maxCacheEntries) {\n        // If we're over the cap, remove the last entry from the array (representing the least-used\n        // item) from the cache and then resolve with lruOrder.\n        var urlToRemove = lruOrder.pop();\n        debug('Expiring the least-recently used resource, ' + urlToRemove);\n        return cache.delete(urlToRemove).then(function() {\n          debug(urlToRemove + ' was successfully deleted.');\n          return lruOrder;\n        });\n      }\n\n      // If we're under the cap, then just resolve with the new lruOrder.\n      return lruOrder;\n    }).then(function(lruOrder) {\n      return idb.set(cacheName, lruOrder).then(function() {\n        debug('Successfully updated IDB with the new LRU order.');\n      });\n    });\n  });\n}\n\nfunction renameCache(source, destination, options) {\n  debug('Renaming cache: [' + source + '] to [' + destination + ']', options);\n  return caches.delete(destination).then(function() {\n    return Promise.all([\n      caches.open(source),\n      caches.open(destination)\n    ]).then(function(results) {\n      var sourceCache = results[0];\n      var destCache = results[1];\n\n      return sourceCache.keys().then(function(requests) {\n        return Promise.all(requests.map(function(request) {\n          return sourceCache.match(request).then(function(response) {\n            return destCache.put(request, response);\n          });\n        }));\n      }).then(function() {\n        return caches.delete(source);\n      });\n    });\n  });\n}\n\nmodule.exports = {\n  debug: debug,\n  fetchAndCache: fetchAndCache,\n  openCache: openCache,\n  renameCache: renameCache\n};\n","/*\n\tCopyright 2015 Google Inc. All Rights Reserved.\n\n\tLicensed under the Apache License, Version 2.0 (the \"License\");\n\tyou may not use this file except in compliance with the License.\n\tYou may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n\tUnless required by applicable law or agreed to in writing, software\n\tdistributed under the License is distributed on an \"AS IS\" BASIS,\n\tWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\tSee the License for the specific language governing permissions and\n\tlimitations under the License.\n*/\n'use strict';\n\n// TODO: This is necessary to handle different implementations in the wild\n// The spec defines self.registration, but it was not implemented in Chrome 40.\nvar scope;\nif (self.registration) {\n  scope = self.registration.scope;\n} else {\n  scope = self.scope || new URL('./', self.location).href;\n}\n\nmodule.exports = {\n  cacheName: '$$$toolbox-cache$$$' + scope + '$$$',\n  debug: false,\n  maxCacheEntries: null,\n  networkTimeoutSeconds: null,\n  preCacheItems: [],\n  // A regular expression to apply to HTTP response codes. Codes that match\n  // will be considered successes, while others will not, and will not be\n  // cached.\n  successResponses: /^0|([123]\\d\\d)|(40[14567])|410$/\n};\n","/*\n  Copyright 2014 Google Inc. All Rights Reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n'use strict';\n\nvar Route = require('./route');\n\nfunction regexEscape(s) {\n  return s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n}\n\nvar keyMatch = function(map, string) {\n  // This would be better written as a for..of loop, but that would break the minifyify process\n  // in the build.\n  var entriesIterator = map.entries();\n  var item = entriesIterator.next();\n  while (!item.done) {\n    var pattern = new RegExp(item.value[0]);\n    if (pattern.test(string)) {\n      return item.value[1];\n    }\n    item = entriesIterator.next();\n  }\n  return null;\n};\n\nvar Router = function() {\n  this.routes = new Map();\n  this.default = null;\n};\n\n['get', 'post', 'put', 'delete', 'head', 'any'].forEach(function(method) {\n  Router.prototype[method] = function(path, handler, options) {\n    return this.add(method, path, handler, options);\n  };\n});\n\nRouter.prototype.add = function(method, path, handler, options) {\n  options = options || {};\n  var origin = options.origin || self.location.origin;\n  if (origin instanceof RegExp) {\n    origin = origin.source;\n  } else {\n    origin = regexEscape(origin);\n  }\n  method = method.toLowerCase();\n\n  var route = new Route(method, path, handler, options);\n\n  if (!this.routes.has(origin)) {\n    this.routes.set(origin, new Map());\n  }\n\n  var methodMap = this.routes.get(origin);\n  if (!methodMap.has(method)) {\n    methodMap.set(method, new Map());\n  }\n\n  var routeMap = methodMap.get(method);\n  routeMap.set(route.regexp.source, route);\n};\n\nRouter.prototype.matchMethod = function(method, url) {\n  url = new URL(url);\n  var origin = url.origin;\n  var path = url.pathname;\n  method = method.toLowerCase();\n\n  var methods = keyMatch(this.routes, origin);\n  if (!methods) {\n    return null;\n  }\n\n  var routes = methods.get(method);\n  if (!routes) {\n    return null;\n  }\n\n  var route = keyMatch(routes, path);\n\n  if (route) {\n    return route.makeHandler(path);\n  }\n\n  return null;\n};\n\nRouter.prototype.match = function(request) {\n  return this.matchMethod(request.method, request.url) || this.matchMethod('any', request.url);\n};\n\nmodule.exports = new Router();\n","/*\n\tCopyright 2014 Google Inc. All Rights Reserved.\n\n\tLicensed under the Apache License, Version 2.0 (the \"License\");\n\tyou may not use this file except in compliance with the License.\n\tYou may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n\tUnless required by applicable law or agreed to in writing, software\n\tdistributed under the License is distributed on an \"AS IS\" BASIS,\n\tWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\tSee the License for the specific language governing permissions and\n\tlimitations under the License.\n*/\nmodule.exports = {\n  networkOnly: require('./networkOnly'),\n  networkFirst: require('./networkFirst'),\n  cacheOnly: require('./cacheOnly'),\n  cacheFirst: require('./cacheFirst'),\n  fastest: require('./fastest')\n};\n","/**\n* Copyright 2015 Google Inc. All rights reserved.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*     http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n/* eslint-disable new-cap */\n// From https://gist.github.com/inexorabletash/c8069c042b734519680c (Joshua Bell)\n'use strict';\n\nvar SECRET = Object.create(null);\nvar DB_PREFIX = '$SimpleDB$';\nvar STORE = 'store';\n\nfunction SimpleDBFactory(secret) {\n  if (secret !== SECRET) {\n    throw TypeError('Invalid constructor');\n  }\n}\n\nSimpleDBFactory.prototype = {\n  open: function(name) {\n    return new Promise(function(resolve, reject) {\n      var request = indexedDB.open(DB_PREFIX + name);\n      request.onupgradeneeded = function() {\n        var db = request.result;\n        db.createObjectStore(STORE);\n      };\n      request.onsuccess = function() {\n        var db = request.result;\n        resolve(new SimpleDB(SECRET, name, db));\n      };\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  },\n  delete: function(name) {\n    return new Promise(function(resolve, reject) {\n      var request = indexedDB.deleteDatabase(DB_PREFIX + name);\n      request.onsuccess = function() {\n        resolve(undefined);\n      };\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n};\n\nfunction SimpleDB(secret, name, db) {\n  if (secret !== SECRET) {\n    throw TypeError('Invalid constructor');\n  }\n  this._name = name;\n  this._db = db;\n}\nSimpleDB.cmp = indexedDB.cmp;\nSimpleDB.prototype = {\n  get name() {\n    return this._name;\n  },\n  get: function(key) {\n    var that = this;\n    return new Promise(function(resolve, reject) {\n      var tx = that._db.transaction(STORE, 'readwrite');\n      var store = tx.objectStore(STORE);\n      var req = store.get(key);\n      // NOTE: Could also use req.onsuccess/onerror\n      tx.oncomplete = function() {\n        resolve(req.result);\n      };\n      tx.onabort = function() {\n        reject(tx.error);\n      };\n    });\n  },\n  set: function(key, value) {\n    var that = this;\n    return new Promise(function(resolve, reject) {\n      var tx = that._db.transaction(STORE, 'readwrite');\n      var store = tx.objectStore(STORE);\n      store.put(value, key);\n      tx.oncomplete = function() {\n        resolve(undefined);\n      };\n      tx.onabort = function() {\n        reject(tx.error);\n      };\n    });\n  },\n  delete: function(key) {\n    var that = this;\n    return new Promise(function(resolve, reject) {\n      var tx = that._db.transaction(STORE, 'readwrite');\n      var store = tx.objectStore(STORE);\n      store.delete(key);\n      tx.oncomplete = function() {\n        resolve(undefined);\n      };\n      tx.onabort = function() {\n        reject(tx.error);\n      };\n    });\n  },\n  clear: function() {\n    var that = this;\n    return new Promise(function(resolve, reject) {\n      var tx = that._db.transaction(STORE, 'readwrite');\n      var store = tx.objectStore(STORE);\n      store.clear();\n      tx.oncomplete = function() {\n        resolve(undefined);\n      };\n      tx.onabort = function() {\n        reject(tx.error);\n      };\n    });\n  },\n  forEach: function(callback, options) {\n    var that = this;\n    return new Promise(function(resolve, reject) {\n      options = options || {};\n      var tx = that._db.transaction(STORE, 'readwrite');\n      var store = tx.objectStore(STORE);\n      var request = store.openCursor(\n        options.range,\n        options.direction === 'reverse' ? 'prev' : 'next');\n      request.onsuccess = function() {\n        var cursor = request.result;\n        if (!cursor) {\n          return;\n        }\n        try {\n          var terminate = callback(cursor.key, cursor.value);\n          if (!terminate) {\n            cursor.continue();\n          }\n        } catch (ex) {\n          tx.abort(); // ???\n        }\n      };\n      tx.oncomplete = function() {\n        resolve(undefined);\n      };\n      tx.onabort = function() {\n        reject(tx.error);\n      };\n    });\n  },\n  getMany: function(keys) {\n    var that = this;\n    return new Promise(function(resolve, reject) {\n      var tx = that._db.transaction(STORE, 'readwrite');\n      var store = tx.objectStore(STORE);\n      var results = [];\n      keys.forEach(function(key) {\n        store.get(key).onsuccess(function(result) {\n          results.push(result);\n        });\n      });\n      tx.oncomplete = function() {\n        resolve(results);\n      };\n      tx.onabort = function() {\n        reject(tx.error);\n      };\n    });\n  },\n  setMany: function(entries) {\n    var that = this;\n    return new Promise(function(resolve, reject) {\n      var tx = that._db.transaction(STORE, 'readwrite');\n      var store = tx.objectStore(STORE);\n      entries.forEach(function(entry) {\n        store.put(entry.value, entry.key);\n      });\n      tx.oncomplete = function() {\n        resolve(undefined);\n      };\n      tx.onabort = function() {\n        reject(tx.error);\n      };\n    });\n  },\n  deleteMany: function(keys) {\n    var that = this;\n    return new Promise(function(resolve, reject) {\n      var tx = that._db.transaction(STORE, 'readwrite');\n      var store = tx.objectStore(STORE);\n      keys.forEach(function(key) {\n        store.delete(key);\n      });\n      tx.oncomplete = function() {\n        resolve(undefined);\n      };\n      tx.onabort = function() {\n        reject(tx.error);\n      };\n    });\n  }\n};\n\nmodule.exports = new SimpleDBFactory(SECRET);\n","/*\n  Copyright 2014 Google Inc. All Rights Reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n'use strict';\n\n// TODO: Use self.registration.scope instead of self.location\nvar url = new URL('./', self.location);\nvar basePath = url.pathname;\nvar pathRegexp = require('path-to-regexp');\n\nvar Route = function(method, path, handler, options) {\n  // The URL() constructor can't parse express-style routes as they are not\n  // valid urls. This means we have to manually manipulate relative urls into\n  // absolute ones. This check is extremely naive but implementing a tweaked\n  // version of the full algorithm seems like overkill\n  // (https://url.spec.whatwg.org/#concept-basic-url-parser)\n  if (path.indexOf('/') !== 0) {\n    path = basePath + path;\n  }\n\n  this.method = method;\n  this.keys = [];\n  this.regexp = pathRegexp(path, this.keys);\n  this.options = options;\n  this.handler = handler;\n};\n\nRoute.prototype.makeHandler = function(url) {\n  var match = this.regexp.exec(url);\n  var values = {};\n  this.keys.forEach(function(key, index) {\n    values[key.name] = match[index + 1];\n  });\n  return function(request) {\n    return this.handler(request, values, this.options);\n  }.bind(this);\n};\n\nmodule.exports = Route;\n","/**\n * Copyright 2015 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nif (!Cache.prototype.addAll) {\n  Cache.prototype.addAll = function addAll(requests) {\n    var cache = this;\n\n    // Since DOMExceptions are not constructable:\n    function NetworkError(message) {\n      this.name = 'NetworkError';\n      this.code = 19;\n      this.message = message;\n    }\n    NetworkError.prototype = Object.create(Error.prototype);\n\n    return Promise.resolve().then(function() {\n      if (arguments.length < 1) throw new TypeError();\n\n      // Simulate sequence<(Request or USVString)> binding:\n      var sequence = [];\n\n      requests = requests.map(function(request) {\n        if (request instanceof Request) {\n          return request;\n        }\n        else {\n          return String(request); // may throw TypeError\n        }\n      });\n\n      return Promise.all(\n        requests.map(function(request) {\n          if (typeof request === 'string') {\n            request = new Request(request);\n          }\n\n          var scheme = new URL(request.url).protocol;\n\n          if (scheme !== 'http:' && scheme !== 'https:') {\n            throw new NetworkError(\"Invalid scheme\");\n          }\n\n          return fetch(request.clone());\n        })\n      );\n    }).then(function(responses) {\n      // TODO: check that requests don't overwrite one another\n      // (don't think this is possible to polyfill due to opaque responses)\n      return Promise.all(\n        responses.map(function(response, i) {\n          return cache.put(requests[i], response);\n        })\n      );\n    }).then(function() {\n      return undefined;\n    });\n  };\n}\n","/*\n\tCopyright 2014 Google Inc. All Rights Reserved.\n\n\tLicensed under the Apache License, Version 2.0 (the \"License\");\n\tyou may not use this file except in compliance with the License.\n\tYou may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n\tUnless required by applicable law or agreed to in writing, software\n\tdistributed under the License is distributed on an \"AS IS\" BASIS,\n\tWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\tSee the License for the specific language governing permissions and\n\tlimitations under the License.\n*/\n'use strict';\nvar helpers = require('../helpers');\n\nfunction networkOnly(request, values, options) {\n  helpers.debug('Strategy: network only [' + request.url + ']', options);\n  return fetch(request);\n}\n\nmodule.exports = networkOnly;\n","/*\n\tCopyright 2014 Google Inc. All Rights Reserved.\n\n\tLicensed under the Apache License, Version 2.0 (the \"License\");\n\tyou may not use this file except in compliance with the License.\n\tYou may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n\tUnless required by applicable law or agreed to in writing, software\n\tdistributed under the License is distributed on an \"AS IS\" BASIS,\n\tWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\tSee the License for the specific language governing permissions and\n\tlimitations under the License.\n*/\n'use strict';\nvar helpers = require('../helpers');\n\nfunction cacheOnly(request, values, options) {\n  helpers.debug('Strategy: cache only [' + request.url + ']', options);\n  return helpers.openCache(options).then(function(cache) {\n    return cache.match(request);\n  });\n}\n\nmodule.exports = cacheOnly;\n","/*\n Copyright 2015 Google Inc. All Rights Reserved.\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n'use strict';\nvar globalOptions = require('../options');\nvar helpers = require('../helpers');\n\nfunction networkFirst(request, values, options) {\n  options = options || {};\n  var successResponses = options.successResponses || globalOptions.successResponses;\n  // This will bypass options.networkTimeout if it's set to a false-y value like 0, but that's the\n  // sane thing to do anyway.\n  var networkTimeoutSeconds = options.networkTimeoutSeconds || globalOptions.networkTimeoutSeconds;\n  helpers.debug('Strategy: network first [' + request.url + ']', options);\n\n  return helpers.openCache(options).then(function(cache) {\n    var timeoutId;\n    var promises = [];\n\n    if (networkTimeoutSeconds) {\n      var cacheWhenTimedOutPromise = new Promise(function(resolve) {\n        timeoutId = setTimeout(function() {\n          cache.match(request).then(function(response) {\n            if (response) {\n              // Only resolve this promise if there's a valid response in the cache.\n              // This ensures that we won't time out a network request unless there's a cached entry\n              // to fallback on, which is arguably the preferable behavior.\n              resolve(response);\n            }\n          });\n        }, networkTimeoutSeconds * 1000);\n      });\n      promises.push(cacheWhenTimedOutPromise);\n    }\n\n    var networkPromise = helpers.fetchAndCache(request, options).then(function(response) {\n      // We've got a response, so clear the network timeout if there is one.\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n\n      if (successResponses.test(response.status)) {\n        return response;\n      }\n\n      helpers.debug('Response was an HTTP error: ' + response.statusText, options);\n      throw new Error('Bad response');\n    }).catch(function() {\n      helpers.debug('Network or response error, fallback to cache [' + request.url + ']', options);\n      return cache.match(request);\n    });\n    promises.push(networkPromise);\n\n    return Promise.race(promises);\n  });\n}\n\nmodule.exports = networkFirst;\n","/*\n\tCopyright 2014 Google Inc. All Rights Reserved.\n\n\tLicensed under the Apache License, Version 2.0 (the \"License\");\n\tyou may not use this file except in compliance with the License.\n\tYou may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n\tUnless required by applicable law or agreed to in writing, software\n\tdistributed under the License is distributed on an \"AS IS\" BASIS,\n\tWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\tSee the License for the specific language governing permissions and\n\tlimitations under the License.\n*/\n'use strict';\nvar helpers = require('../helpers');\n\nfunction cacheFirst(request, values, options) {\n  helpers.debug('Strategy: cache first [' + request.url + ']', options);\n  return helpers.openCache(options).then(function(cache) {\n    return cache.match(request).then(function(response) {\n      if (response) {\n        return response;\n      }\n\n      return helpers.fetchAndCache(request, options);\n    });\n  });\n}\n\nmodule.exports = cacheFirst;\n","/*\n  Copyright 2014 Google Inc. All Rights Reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n'use strict';\nvar helpers = require('../helpers');\nvar cacheOnly = require('./cacheOnly');\n\nfunction fastest(request, values, options) {\n  helpers.debug('Strategy: fastest [' + request.url + ']', options);\n\n  return new Promise(function(resolve, reject) {\n    var rejected = false;\n    var reasons = [];\n\n    var maybeReject = function(reason) {\n      reasons.push(reason.toString());\n      if (rejected) {\n        reject(new Error('Both cache and network failed: \"' + reasons.join('\", \"') + '\"'));\n      } else {\n        rejected = true;\n      }\n    };\n\n    var maybeResolve = function(result) {\n      if (result instanceof Response) {\n        resolve(result);\n      } else {\n        maybeReject('No result returned');\n      }\n    };\n\n    helpers.fetchAndCache(request.clone(), options)\n      .then(maybeResolve, maybeReject);\n\n    cacheOnly(request, options)\n      .then(maybeResolve, maybeReject);\n  });\n}\n\nmodule.exports = fastest;\n","var isarray = require('isarray')\n\n/**\n * Expose `pathToRegexp`.\n */\nmodule.exports = pathToRegexp\nmodule.exports.parse = parse\nmodule.exports.compile = compile\nmodule.exports.tokensToFunction = tokensToFunction\nmodule.exports.tokensToRegExp = tokensToRegExp\n\n/**\n * The main path matching regexp utility.\n *\n * @type {RegExp}\n */\nvar PATH_REGEXP = new RegExp([\n  // Match escaped characters that would otherwise appear in future matches.\n  // This allows the user to escape special characters that won't transform.\n  '(\\\\\\\\.)',\n  // Match Express-style parameters and un-named parameters with a prefix\n  // and optional suffixes. Matches appear as:\n  //\n  // \"/:test(\\\\d+)?\" => [\"/\", \"test\", \"\\d+\", undefined, \"?\", undefined]\n  // \"/route(\\\\d+)\"  => [undefined, undefined, undefined, \"\\d+\", undefined, undefined]\n  // \"/*\"            => [\"/\", undefined, undefined, undefined, undefined, \"*\"]\n  '([\\\\/.])?(?:(?:\\\\:(\\\\w+)(?:\\\\(((?:\\\\\\\\.|[^()])+)\\\\))?|\\\\(((?:\\\\\\\\.|[^()])+)\\\\))([+*?])?|(\\\\*))'\n].join('|'), 'g')\n\n/**\n * Parse a string for the raw tokens.\n *\n * @param  {String} str\n * @return {Array}\n */\nfunction parse (str) {\n  var tokens = []\n  var key = 0\n  var index = 0\n  var path = ''\n  var res\n\n  while ((res = PATH_REGEXP.exec(str)) != null) {\n    var m = res[0]\n    var escaped = res[1]\n    var offset = res.index\n    path += str.slice(index, offset)\n    index = offset + m.length\n\n    // Ignore already escaped sequences.\n    if (escaped) {\n      path += escaped[1]\n      continue\n    }\n\n    // Push the current path onto the tokens.\n    if (path) {\n      tokens.push(path)\n      path = ''\n    }\n\n    var prefix = res[2]\n    var name = res[3]\n    var capture = res[4]\n    var group = res[5]\n    var suffix = res[6]\n    var asterisk = res[7]\n\n    var repeat = suffix === '+' || suffix === '*'\n    var optional = suffix === '?' || suffix === '*'\n    var delimiter = prefix || '/'\n    var pattern = capture || group || (asterisk ? '.*' : '[^' + delimiter + ']+?')\n\n    tokens.push({\n      name: name || key++,\n      prefix: prefix || '',\n      delimiter: delimiter,\n      optional: optional,\n      repeat: repeat,\n      pattern: escapeGroup(pattern)\n    })\n  }\n\n  // Match any characters still remaining.\n  if (index < str.length) {\n    path += str.substr(index)\n  }\n\n  // If the path exists, push it onto the end.\n  if (path) {\n    tokens.push(path)\n  }\n\n  return tokens\n}\n\n/**\n * Compile a string to a template function for the path.\n *\n * @param  {String}   str\n * @return {Function}\n */\nfunction compile (str) {\n  return tokensToFunction(parse(str))\n}\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nfunction tokensToFunction (tokens) {\n  // Compile all the tokens into regexps.\n  var matches = new Array(tokens.length)\n\n  // Compile all the patterns before compilation.\n  for (var i = 0; i < tokens.length; i++) {\n    if (typeof tokens[i] === 'object') {\n      matches[i] = new RegExp('^' + tokens[i].pattern + '$')\n    }\n  }\n\n  return function (obj) {\n    var path = ''\n    var data = obj || {}\n\n    for (var i = 0; i < tokens.length; i++) {\n      var token = tokens[i]\n\n      if (typeof token === 'string') {\n        path += token\n\n        continue\n      }\n\n      var value = data[token.name]\n      var segment\n\n      if (value == null) {\n        if (token.optional) {\n          continue\n        } else {\n          throw new TypeError('Expected \"' + token.name + '\" to be defined')\n        }\n      }\n\n      if (isarray(value)) {\n        if (!token.repeat) {\n          throw new TypeError('Expected \"' + token.name + '\" to not repeat, but received \"' + value + '\"')\n        }\n\n        if (value.length === 0) {\n          if (token.optional) {\n            continue\n          } else {\n            throw new TypeError('Expected \"' + token.name + '\" to not be empty')\n          }\n        }\n\n        for (var j = 0; j < value.length; j++) {\n          segment = encodeURIComponent(value[j])\n\n          if (!matches[i].test(segment)) {\n            throw new TypeError('Expected all \"' + token.name + '\" to match \"' + token.pattern + '\", but received \"' + segment + '\"')\n          }\n\n          path += (j === 0 ? token.prefix : token.delimiter) + segment\n        }\n\n        continue\n      }\n\n      segment = encodeURIComponent(value)\n\n      if (!matches[i].test(segment)) {\n        throw new TypeError('Expected \"' + token.name + '\" to match \"' + token.pattern + '\", but received \"' + segment + '\"')\n      }\n\n      path += token.prefix + segment\n    }\n\n    return path\n  }\n}\n\n/**\n * Escape a regular expression string.\n *\n * @param  {String} str\n * @return {String}\n */\nfunction escapeString (str) {\n  return str.replace(/([.+*?=^!:${}()[\\]|\\/])/g, '\\\\$1')\n}\n\n/**\n * Escape the capturing group by escaping special characters and meaning.\n *\n * @param  {String} group\n * @return {String}\n */\nfunction escapeGroup (group) {\n  return group.replace(/([=!:$\\/()])/g, '\\\\$1')\n}\n\n/**\n * Attach the keys as a property of the regexp.\n *\n * @param  {RegExp} re\n * @param  {Array}  keys\n * @return {RegExp}\n */\nfunction attachKeys (re, keys) {\n  re.keys = keys\n  return re\n}\n\n/**\n * Get the flags for a regexp from the options.\n *\n * @param  {Object} options\n * @return {String}\n */\nfunction flags (options) {\n  return options.sensitive ? '' : 'i'\n}\n\n/**\n * Pull out keys from a regexp.\n *\n * @param  {RegExp} path\n * @param  {Array}  keys\n * @return {RegExp}\n */\nfunction regexpToRegexp (path, keys) {\n  // Use a negative lookahead to match only capturing groups.\n  var groups = path.source.match(/\\((?!\\?)/g)\n\n  if (groups) {\n    for (var i = 0; i < groups.length; i++) {\n      keys.push({\n        name: i,\n        prefix: null,\n        delimiter: null,\n        optional: false,\n        repeat: false,\n        pattern: null\n      })\n    }\n  }\n\n  return attachKeys(path, keys)\n}\n\n/**\n * Transform an array into a regexp.\n *\n * @param  {Array}  path\n * @param  {Array}  keys\n * @param  {Object} options\n * @return {RegExp}\n */\nfunction arrayToRegexp (path, keys, options) {\n  var parts = []\n\n  for (var i = 0; i < path.length; i++) {\n    parts.push(pathToRegexp(path[i], keys, options).source)\n  }\n\n  var regexp = new RegExp('(?:' + parts.join('|') + ')', flags(options))\n\n  return attachKeys(regexp, keys)\n}\n\n/**\n * Create a path regexp from string input.\n *\n * @param  {String} path\n * @param  {Array}  keys\n * @param  {Object} options\n * @return {RegExp}\n */\nfunction stringToRegexp (path, keys, options) {\n  var tokens = parse(path)\n  var re = tokensToRegExp(tokens, options)\n\n  // Attach keys back to the regexp.\n  for (var i = 0; i < tokens.length; i++) {\n    if (typeof tokens[i] !== 'string') {\n      keys.push(tokens[i])\n    }\n  }\n\n  return attachKeys(re, keys)\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n *\n * @param  {Array}  tokens\n * @param  {Array}  keys\n * @param  {Object} options\n * @return {RegExp}\n */\nfunction tokensToRegExp (tokens, options) {\n  options = options || {}\n\n  var strict = options.strict\n  var end = options.end !== false\n  var route = ''\n  var lastToken = tokens[tokens.length - 1]\n  var endsWithSlash = typeof lastToken === 'string' && /\\/$/.test(lastToken)\n\n  // Iterate over the tokens and create our regexp string.\n  for (var i = 0; i < tokens.length; i++) {\n    var token = tokens[i]\n\n    if (typeof token === 'string') {\n      route += escapeString(token)\n    } else {\n      var prefix = escapeString(token.prefix)\n      var capture = token.pattern\n\n      if (token.repeat) {\n        capture += '(?:' + prefix + capture + ')*'\n      }\n\n      if (token.optional) {\n        if (prefix) {\n          capture = '(?:' + prefix + '(' + capture + '))?'\n        } else {\n          capture = '(' + capture + ')?'\n        }\n      } else {\n        capture = prefix + '(' + capture + ')'\n      }\n\n      route += capture\n    }\n  }\n\n  // In non-strict mode we allow a slash at the end of match. If the path to\n  // match already ends with a slash, we remove it for consistency. The slash\n  // is valid at the end of a path match, not in the middle. This is important\n  // in non-ending mode, where \"/test/\" shouldn't match \"/test//route\".\n  if (!strict) {\n    route = (endsWithSlash ? route.slice(0, -2) : route) + '(?:\\\\/(?=$))?'\n  }\n\n  if (end) {\n    route += '$'\n  } else {\n    // In non-ending mode, we need the capturing groups to match as much as\n    // possible by using a positive lookahead to the end or next path segment.\n    route += strict && endsWithSlash ? '' : '(?=\\\\/|$)'\n  }\n\n  return new RegExp('^' + route, flags(options))\n}\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n *\n * @param  {(String|RegExp|Array)} path\n * @param  {Array}                 [keys]\n * @param  {Object}                [options]\n * @return {RegExp}\n */\nfunction pathToRegexp (path, keys, options) {\n  keys = keys || []\n\n  if (!isarray(keys)) {\n    options = keys\n    keys = []\n  } else if (!options) {\n    options = {}\n  }\n\n  if (path instanceof RegExp) {\n    return regexpToRegexp(path, keys, options)\n  }\n\n  if (isarray(path)) {\n    return arrayToRegexp(path, keys, options)\n  }\n\n  return stringToRegexp(path, keys, options)\n}\n","module.exports = Array.isArray || function (arr) {\n  return Object.prototype.toString.call(arr) == '[object Array]';\n};\n"]}